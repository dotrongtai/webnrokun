<%- include("../partials/header", { title: "N·∫°p ti·ªÅn PayOS" }) %>

<div style="max-width:500px; margin:30px auto; background:#fff; padding:20px; border-radius:10px;">
  <h2>üí∞ N·∫°p ti·ªÅn PayOS</h2>

  <input id="amount" type="number" placeholder="Nh·∫≠p s·ªë ti·ªÅn" style="width:100%; padding:10px;">
  <button id="btnTopup" style="margin-top:10px; width:100%; padding:10px; background:#1e88e5; color:white; border:none;">
    T·∫°o QR thanh to√°n
  </button>

  <div id="result" style="margin-top:15px;"></div>
</div>

<script>
  document.getElementById("btnTopup").addEventListener("click", async () => {
    const amount = document.getElementById("amount").value;

    const res = await fetch("/topup/create", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ amount })
    });

    const data = await res.json();

    if (!data.success) {
      document.getElementById("result").innerHTML = `<p style="color:red">${data.message}</p>`;
      return;
    }

    // ‚úÖ redirect sang PayOS checkout
    window.location.href = data.checkoutUrl;
  });
</script>

<%- include("../partials/footer") %>
